================================================================================
NDA数据增强使用说明
Neuromorphic Data Augmentation Usage Guide
================================================================================

一、快速使用
------------
只需在数据集初始化时添加 use_nda=True：

from dataloader.cifar import DVSCifar10v1

train_dataset = DVSCifar10v1(
    root='path/to/data',
    train=True,
    transform=True,
    use_nda=True  # 启用NDA增强
)


二、核心功能
------------
1. DVS数据增强（NDA）
   - 水平翻转：50%概率（默认）
   - 随机选择以下一种：
     * Roll（平移）
     * Rotate（旋转）
     * Shear（剪切）

2. CutMix数据增强（推荐使用）
   - 通过线性插值混合两个样本
   - 增强数据多样性

3. Mixup数据增强（可选）
   - 像素级混合


三、使用CutMix（推荐）
---------------------
from dataloader import cutmix_data, mixup_criterion
import torch.nn as nn

criterion = nn.CrossEntropyLoss()

for data, target in train_loader:
    data, target = data.cuda(), target.cuda()
    
    # 应用CutMix（默认推荐）
    data, target_a, target_b, lam = cutmix_data(data, target, alpha=1.0)
    
    # 计算混合损失
    output = model(data)
    loss = mixup_criterion(criterion, output, target_a, target_b, lam)
    
    optimizer.zero_grad()
    loss.backward()
    optimizer.step()


四、支持的数据集
----------------
- CIFAR10-DVS: DVSCifar10v1(..., use_nda=True)
- N-MNIST: NMNIST1(..., use_nda=True)
- N-Caltech101: NCaltech101Dataset(..., use_nda=True)


五、数据增强参数
----------------
数据集          Roll范围    旋转角度    Shear范围    水平翻转
CIFAR10-DVS    (-5, 5)     30°        (-30, 30)    50%
N-Caltech101   (-3, 3)     15°        (-15, 15)    50%
N-MNIST        (-3, 3)     10°        (-10, 10)    50%


六、完整训练示例（NDA + CutMix）
--------------------------------
from dataloader.cifar import DVSCifar10v1
from dataloader import cutmix_data, mixup_criterion
import torch
import torch.nn as nn
from torch.utils.data import DataLoader

# 1. 创建数据集（启用NDA）
train_dataset = DVSCifar10v1(
    root='data/train',
    train=True,
    transform=True,
    use_nda=True
)

test_dataset = DVSCifar10v1(
    root='data/test',
    train=False,
    transform=False  # 测试时不增强
)

# 2. 创建数据加载器
train_loader = DataLoader(train_dataset, batch_size=32, shuffle=True)
test_loader = DataLoader(test_dataset, batch_size=32, shuffle=False)

# 3. 训练（使用CutMix）
model = YourModel().cuda()
criterion = nn.CrossEntropyLoss()
optimizer = torch.optim.Adam(model.parameters(), lr=0.001)

for epoch in range(epochs):
    model.train()
    for data, target in train_loader:
        data, target = data.cuda(), target.cuda()
        
        # 应用CutMix（推荐默认使用）
        data, target_a, target_b, lam = cutmix_data(data, target, alpha=1.0)
        
        output = model(data)
        loss = mixup_criterion(criterion, output, target_a, target_b, lam)
        
        optimizer.zero_grad()
        loss.backward()
        optimizer.step()


七、预期性能提升
----------------
数据集          基线准确率    +NDA准确率    提升
N-Caltech101   ~65%         ~72%         +7%
CIFAR10-DVS    ~60%         ~68%         +8%


八、重要说明
------------
1. 水平翻转概率固定为0.5（50%）
2. CutMix是推荐的默认数据增强方法
3. 训练时启用增强：transform=True, use_nda=True
4. 测试时关闭增强：transform=False
5. NDA增强已包含水平翻转，无需额外设置


九、导入说明
------------
from dataloader import (
    DVSAugment,              # 通用增强器
    DVSAugmentCIFAR10,       # CIFAR10专用
    DVSAugmentCaltech101,    # Caltech101专用
    cutmix_data,             # CutMix增强（推荐）
    mixup_data,              # Mixup增强（可选）
    mixup_criterion          # 混合损失函数
)


十、常见问题
------------
Q1: 如何只使用NDA不使用CutMix？
A1: 在训练循环中不调用cutmix_data()即可，只设置use_nda=True

Q2: 可以调整水平翻转概率吗？
A2: 默认0.5，如需修改可在创建增强器时指定flip_prob参数

Q3: CutMix的alpha参数如何设置？
A3: 默认1.0即可，这是论文推荐值

Q4: 测试时需要增强吗？
A4: 不需要，测试时设置transform=False


十一、更新日志
--------------
2025-01-24: 
- 集成NDA_SNN数据增强方法
- 添加水平翻转（概率0.5）
- 添加CutMix支持（推荐默认使用）
- 更新所有DVS数据集类

================================================================================

